CKEDITOR.dialog.add("base64imageDialog",function(h){function l(a){if("string"==typeof a&&a&&"d"===a.charAt(0)){var e=new Image;d.getElement().setHtml("Loading...");e.onload=function(){d.getElement().setHtml("");null==c||null==f?(g=1,0<this.height&&0<this.width&&(g=this.width/this.height),0>=g&&(g=1)):f=c=null;this.id=h.id+"previewimage";this.setAttribute("style","max-width:400px;max-height:100px;");this.setAttribute("alt","");try{var a=d.getElement().$;a&&a.appendChild(this)}catch(e){alert("Erro processando imagem.")}};
e.onerror=function(){d.getElement().setHtml("")};e.onabort=function(){d.getElement().setHtml("")};e.src=a}else d.getElement().setHtml(""),alert(a)}function p(a){d.getElement().setHtml("");if("base64"!=a&&"url"!=a&&m){var e=CKEDITOR.config.base64image_filetypes,b=k.getContentElement("tab-source","filArquivo");a=null;try{a=b.getInputElement().$}catch(c){a=null}a&&"files"in a&&a.files&&0<a.files.length&&a.files[0]&&("type"in a.files[0]&&!a.files[0].type.match("image.("+e+")")?alert("Tipo de arquivo não permitido."):
FileReader&&(d.getElement().setHtml("Loading..."),e=new FileReader,e.onload=function(a){return function(a){d.getElement().setHtml("");l(a.target.result)}}(a.files[0]),e.onerror=function(){d.getElement().setHtml("")},e.onabort=function(){d.getElement().setHtml("")},e.readAsDataURL(a.files[0])))}}var k=null,b=null,c=null,f=null,n=null,d=null,g=1,m=function(){var a=!1;try{if(FileReader){var b=document.createElement("input");b&&"files"in b&&(a=!0)}}catch(d){a=!1}return a}(),q=m?[{type:"file",id:"filArquivo",
label:"Arquivo:",size:50,onChange:function(){p("filArquivo")}},{type:"html",id:"preview",html:(new CKEDITOR.template('\x3cdiv style\x3d"text-align:center;"\x3e\x3c/div\x3e')).output()}]:[{type:"file",id:"filArquivo",size:50,label:"Arquivo:",onChange:function(){d.getElement().setHtml("");var a=k.getContentElement("tab-source","filArquivo");try{a.getInputElement()}catch(b){}d.getElement().setHtml("Loading...");n.executar()}},{type:"html",id:"preview",html:(new CKEDITOR.template('\x3cdiv style\x3d"text-align:center;"\x3e\x3c/div\x3e')).output()}];
return{title:h.lang.common.image,minWidth:450,minHeight:180,onLoad:function(){d=this.getContentElement("tab-source","preview")},onShow:function(){if(!m){var a=this.getContentElement("tab-source","filArquivo").getInputElement().$.parentNode;a.id="EditorSeiUpload";n=new infraUploadCK(a,CKEDITOR.config.base64imageUploadUrl,!0);n.finalizou=function(a){objAjaxPlugin=new infraAjaxComplementar(null,CKEDITOR.config.base64imageAjaxUrl);objAjaxPlugin.tipo=null;objAjaxPlugin.processarResultado=function(a){l(a.base64.toString())};
objAjaxPlugin.prepararExecucao=function(){return"img\x3d"+a.nome_upload};objAjaxPlugin.executar()}}d.getElement().setHtml("");k=this;f=c=null;g=1;lock=!0;(b=h.getSelection())&&(b=b.getSelectedElement());b&&"img"===b.getName()||(b=null);b&&(null!=c&&null!=f||!b.$||(c=b.$.width,f=b.$.height),null!=c&&null!=f&&(c=parseInt(c,10),f=parseInt(f,10),g=1,!isNaN(c)&&!isNaN(f)&&0<f&&0<c&&(g=c/f),0>=g&&(g=1)),"string"==typeof b.getAttribute("src")&&(0===b.getAttribute("src").indexOf("data:")?(p("base64"),l(b.getAttribute("src"))):
k.setValueOf("tab-source","url",b.getAttribute("src"))))},onOk:function(){var a="";try{a=0<INFRA_IE&&9>INFRA_IE?CKEDITOR.document.getById(h.id+"previewimage").$.href:CKEDITOR.document.getById(h.id+"previewimage").$.src}catch(d){a=""}if("string"==typeof a&&null!=a&&""!==a){var c;b?(c=b,c.setAttribute("data-cke-saved-src",a)):c=h.document.createElement("img");c.setAttribute("src",a);a=[];0<a.length&&c.setAttribute("style",a.join(""));b||h.insertElement(c)}},contents:[{id:"tab-source",label:h.lang.common.generalTab,
elements:q}]}});